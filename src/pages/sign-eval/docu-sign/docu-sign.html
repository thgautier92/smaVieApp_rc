<!--
  Generated template for the DocuSign page.

  See http://ionicframework.com/docs/v2/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
	<ion-navbar color="secondary">
		<button ion-button menuToggle>
      <ion-icon name="menu"></ion-icon>
    </button>
		<ion-title>DocuSign</ion-title>
		<ion-buttons end>
			<button ion-button (click)="openAdminCtrl()">Console d'administration</button>
		</ion-buttons>
	</ion-navbar>
</ion-header>

<ion-content padding>
	<h4>Opérations de signature pour : {{signSend.name}}</h4>
	<div padding>
		<ion-segment [(ngModel)]="option">
			<ion-segment-button text-wrap *ngFor="let api of lstApi" [value]="api.code">{{api.title}}</ion-segment-button>
		</ion-segment>
	</div>
	<div [ngSwitch]="option">
		<div *ngSwitchCase="'lstEnvelopes'">
			<button ion-button (click)="listEnvelopes(4)">Actualiser</button> Gauche :options emetteur,Droite : options signataire
			<ion-list>
				<ion-item-sliding *ngFor="let item of lstEnvelopes['folderItems']" text-wrap>
					<ion-item>
						<ion-row>
							<ion-col width-80>
								<h2 color="danger">{{item.subject}}</h2>
							</ion-col>
							<ion-col>
								<ion-note width-20>#{{item.envelopeId}}</ion-note>
							</ion-col>
						</ion-row>
						<ion-row>
							<ion-col>
								<h3>Crée le {{item.createdDateTime}} par {{item.senderName}}</h3>
							</ion-col>
							<ion-col>
								<h3>Expiration le {{item.expireDateTime}}</h3>
							</ion-col>
						</ion-row>
						<ion-row>
							<ion-col>
								<h2 color="primary">
									<u>Signataires</u>
								</h2>
								<ion-list no-padding>
									<ion-item *ngFor="let s of item.recipients.signers">
										<ion-row wrap>
											<ion-col width-10>
												<h3>{{s.recipientId}}</h3>
											</ion-col>
											<ion-col width-70 text-wrap>
												<h3>{{s.name}} a pour rôle : {{s.roleName}}</h3>
												<h4>{{s.email}}</h4>
											</ion-col>
											<ion-col width-20 text-wrap>
												{{statusCode[s.status]}}<br>
												<ion-note>{{s.signedDateTime}}</ion-note>
											</ion-col>
										</ion-row>
									</ion-item>
								</ion-list>
							</ion-col>
						</ion-row>
					</ion-item>
					<ion-item-options side="left">
						<button ion-button color="primary" (click)="getDocSigned(item);">Voir</button>
						<button ion-button color="secondary" (click)="signSender(item);">Emetteur</button>
						<button ion-button color="danger" (click)="getDocData(item);">Preuve</button>
					</ion-item-options>
					<ion-item-options side="right">
						<button ion-button color="primary" (click)="getDocSigned(item);">Voir</button>
						<button ion-button color="secondary" (click)="signClient(item['envelopeId']);">Signer</button><br>

					</ion-item-options>
				</ion-item-sliding>
			</ion-list>
		</div>
		<div *ngSwitchCase="'sign'">
			<ion-list>
				<ion-item>
					<ion-label>Modèle de document</ion-label>
					<ion-select [(ngModel)]="signSend.docModel" okText="Choisir" cancelText="Annuler">
						<ion-option *ngFor="let m of lstModels['envelopeTemplates']" [value]="m.templateId">{{m.name}}</ion-option>
					</ion-select>
					<button ion-button clear item-right icon-left (click)="getLstModel()"><ion-icon name="refresh"></ion-icon></button>
				</ion-item>
				<ion-item>
					<button ion-button outline item-left icon-left (click)="sendSign()">
      					<ion-icon name="add-circle"></ion-icon>
						  Envoyer à {{signSend.email}}
					</button>
					<ion-note>#{{signSend['envId']}}</ion-note>
				</ion-item>
				<ion-item>
					<button ion-button outline item-left icon-left (click)="signClient(signSend['envId'])">
      					<ion-icon name="add-circle"></ion-icon>
						  Signature des documents de l'enveloppe
					</button>
					<ion-note></ion-note>
				</ion-item>
			</ion-list>
			<pre>{{signSend|json}}</pre>
		</div>
		<div *ngSwitchCase="'detail'">
			Données en provenance de DocuSign
			<record [dataRecord]='dataDoc'></record>
			<!-- <pre>{{dataDoc | json}}</pre> -->
		</div>
		<div *ngSwitchCase="'model'">
			<a href="https://apiexplorer.docusign.com/#/" target="_blank">DocuSign Api Explorer</a> Caractéristiques d'un modele
			<ion-item>
				<ion-label>Modèle de document</ion-label>
				<ion-select [(ngModel)]="signSend.docModel" okText="Choisir" cancelText="Annuler">
					<ion-option *ngFor="let m of lstModels['envelopeTemplates']" [value]="m.templateId">{{m.name}}</ion-option>
				</ion-select>
				<button ion-button clear item-right icon-left (click)="getLstModel()"><ion-icon name="refresh"></ion-icon></button>
			</ion-item>
			<record [dataRecord]='dataModel'></record>
			<!-- <pre>{{dataDoc | json}}</pre> -->
		</div>
	</div>

</ion-content>